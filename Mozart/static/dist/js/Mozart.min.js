/*! Mozart 11-02-2015 */
"use strict";var app=angular.module("mozArtApp",["ng.django.forms"]);app.config(["$interpolateProvider","$httpProvider",function(a,b){a.startSymbol("{$"),a.endSymbol("$}"),b.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),app.directive("fileUpload",[function(){return{restrict:"A",scope:{fileBind:"="},link:function(a,b){b.bind("change",function(b){for(var c=b.target.files,d=0;d<c.length;d++)a.$emit(a.fileBind,{file:c[d]})})}}}]),app.directive("offClick",["$document","$timeout",function(a,b){function c(a,b){if(!a||!b)return!1;for(var c=angular.element(document.querySelectorAll(b)),d=c.length,e=0;d>e;++e)if(c[e].contains(a))return!0;return!1}return{restrict:"A",scope:{offClick:"&",offClickIf:"&"},link:function(d,e,f){function g(a){if(0!=a.pageX||0!=a.pageY){var b=a.target||a.srcElement;e[0].contains(b)||c(b,f.offClickFilter)||d.$apply(d.offClick())}}f.offClickIf?d.$watch(d.offClickIf,function(c,d){c&&!d?b(function(){a.on("click",g)}):c||a.off("click",g)}):a.on("click",g),d.$on("$destroy",function(){a.off("click",g)})}}}]),app.directive("modalDialog",function(){return{restrict:"E",scope:{show:"=",tituloVentana:"@"},replace:!0,transclude:!0,link:function(a){a.hideModal=function(){a.show=!1}},templateUrl:"scripts/directives/ventanaModal.html"}}),app.directive("comparar",function(){return{restrict:"A",require:"ngModel",scope:{compareTo:"=comparar"},link:function(a,b,c,d){a.validar=function(){return a.compareTo===d.$modelValue},a.$watch(a.validar,function(a){d.$setValidity("noIguales",a)})}}}),app.directive("mzField",function(){return{restrict:"C",link:function(a,b,c){var d="#"+c.id;angular.element(d).focus(function(){angular.element(d).prev("label").css("width","0%"),angular.element(d).prev("label").css("padding","5px 0"),angular.element(d).css("width","90%")}),angular.element(d).blur(function(){angular.element(d).prev("label").css("padding","5px 10px"),angular.element(d).prev("label").css("width","30%"),angular.element(d).css("width","60%")})}}}),app.controller("cargarObrasCtrl",["$scope","peticionObras",function(a,b){a.cantidad=5,a.categoria="a",a.cargar=function(c){b.get(function(b){a.obras=b},function(a,b){alert("Ha fallado la petición. Estado HTTP:"+b)},"recientes",a.categoria,"todos",c),a.cantidad+=4},a.cargar(a.cantidad),a.prueba="http://www.google.com"}]),app.controller("editarInformacionCtrl",["$scope",function(a){a.videoValido=!0,a.portadaValida=!0,a.imagenValida=!0,a.video={name:""},a.portada={name:""},a.imagen={name:""},a.$on("archivoVideo",function(b,c){a.$apply(function(){a.video=c.file,divisiones=a.video.name.split("."),a.formatoVideo=divisiones[divisiones.length-1],a.videoValido=a.verificarVideo(a.formatoVideo)})}),a.$on("archivoPortada",function(b,c){a.$apply(function(){a.portada=c.file,divisiones=a.portada.name.split("."),a.formatoPortada=divisiones[divisiones.length-1],a.portadaValida=a.verificarImagen(a.formatoPortada)})}),a.$on("archivoImagen",function(b,c){a.$apply(function(){a.imagen=c.file,divisiones=a.imagen.name.split("."),a.formatoImagen=divisiones[divisiones.length-1],a.imagenValida=a.verificarImagen(a.formatoImagen)})}),a.verificarVideo=function(a){for(formatosVideo=["mp4","mpeg","avi","3gp"],i=0;i<formatosVideo.length;i++)if(a==formatosVideo[i])return!0;return!1},a.verificarImagen=function(a){for(formatosImagen=["png","gif","jpg","jpeg","bmp","tiff"],i=0;i<formatosImagen.length;i++)if(a==formatosImagen[i])return!0;return!1}}]),app.controller("errorCtrl",["$scope","$routeParams","peticionObras",function(a,b,c){a.cantidad=3,a.cargar=function(){c.get(function(b){a.obras=b},function(a,b){alert("Ha fallado la petición. Estado HTTP:"+b)},"aleatorio","todas","todos",a.cantidad)},a.cargar()}]),app.controller("formularioRegistroCtrl",["$scope","validateAge",function(a,b){a.acepto=!1,a.fechaValida=!0,a.mensaje=!0;a.validarFecha=function(){a.mensaje=b.validDate(a.signup.day_of_birth,a.signup.month_of_birth,a.signup.year_of_birth),a.fechaValida="Ok"===a.mensaje},a.validar=function(){return!(!a.fechaValida||a.signupform.$invalid)}}]),app.controller("menuCtrl",["$scope",function(a){a.visible=!1,a.posicion1={right:"-305px"},a.posicion2={right:"0"},a.posicionDerecha=a.posicion1,a.mostrarMenu=function(){1==a.visible?(a.posicionDerecha=a.posicion1,a.visible=!1):(a.posicionDerecha=a.posicion2,a.visible=!0)}}]),app.controller("modalCtrl",["$scope",function(a){a.modalShown=!1,a.toggleModal=function(){a.modalShown=!a.modalShown}}]),app.controller("perfilArtistaCtrl",["$scope","$log",function(a,b){b.log("Hola")}]),app.controller("perfilPromotorCtrl",["$scope","$log",function(a,b){b.log("Hola")}]),app.controller("informacionPerfilCtrl",["$scope","$log",function(a,b){b.log("Hola")}]),app.controller("configuracionesCtrl",["$scope",function(a){a.validar=function(){alert("Hola "+a.email+"!")}}]),app.controller("loginCtrl",["$scope",function(a){a.validar=function(){alert("Hola "+a.email+"!")}}]),app.controller("subirObraCtrl",["$scope","validateFile",function(a,b){a.maxeti=30,a.archivo={name:""},a.portada={name:""};var c=!0,d=!1,e=!1;a.mostrarTexto1=function(){return""!=a.archivo.name},a.mostrarTexto2=function(){return""!=a.portada.name},a.mostrarMensaje1=function(){return!(d||""==a.archivo.name)},a.mostrarMensaje2=function(){return!(e||""==a.portada.name)},a.mostrarBoton2=function(){return!(c||!d)},a.$on("archive",function(f,g){a.$apply(function(){a.archivo=g.file;var f=b.getExtension(a.archivo);c=b.isAnImage(f),c?(d=!0,e=!0):(d=b.validateFormat(f),e=!1)})}),a.$on("cover",function(c,d){a.$apply(function(){a.portada=d.file;var c=b.getExtension(a.portada);e=b.isAnImage(c)})}),a.validar=function(){return!(!d||!e||a.workform.$invalid)}}]),app.service("peticionObras",["$http",function(a){this.get=function(b,c){a({method:"GET",url:"http://localhost:8000/api/works"}).success(function(a){b(a)}).error(function(a,b){c(a,b)})}}]),app.service("peticionPromotores",["$http",function(a){this.get=function(b,c,d,e,f){a({method:"GET",url:"data/promotores"+f+".json"}).success(function(a){b(a)}).error(function(a,b){c(a,b)})}}]),app.service("validateFile",function(){this.getExtension=function(a){var b=a.name.split("."),c=b[b.length-1];return c},this.validateFormat=function(a){for(var b=["pdf","mp3","aac","wma","mp4","mpeg","avi","3gp"],c=0;c<b.length;c++)if(a==b[c])return!0;return!1},this.isAnImage=function(a){for(var b=["png","gif","jpg","jpeg","bmp","tiff"],c=0;c<b.length;c++)if(a==b[c])return!0;return!1}}),app.service("validateAge",function(){this.current_date=new Date,this.current_year=parseInt(this.current_date.getYear())+1900,this.current_month=parseInt(this.current_date.getMonth())+1,this.current_day=parseInt(this.current_date.getDate()),this.validDate=function(a,b,c){var d;d=isNaN(b)?this.getMonthNumber(b):b;var e=new Date(c,d,"0");return a-0>e.getDate()-0?"La fecha que introduciste no es valida.":this.validAge(a,d,c)},this.validAge=function(a,b,c){var d=this.current_year-c;return this.current_month<b&&d--,b===this.current_month&&this.current_day<a&&d--,d>1900&&(d-=1900),d>=18?"Ok":"Lo sentimos, debes ser mayor de edad"},this.getMonthNumber=function(a){return"Enero"===a?1:"Febrero"===a?2:"Marzo"===a?3:"Abril"===a?4:"Mayo"===a?5:"Junio"===a?6:"Julio"===a?7:"Agosto"===a?8:"Septiembre"===a?9:"Octubre"===a?10:"Noviembre"===a?11:"Diciembre"===a?1:0}});